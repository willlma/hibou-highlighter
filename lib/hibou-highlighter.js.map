{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 508176650e4a709eca3b","webpack:///./src/index.js","webpack:///./src/dom-mutation.js","webpack:///./src/get-selector.js","webpack:///./src/add-spans.js"],"names":["changeSelectedHighlight","highlightRange","highlight","isValidRange","startContainer","endContainer","nodeType","Node","TEXT_NODE","parentElement","localName","getRangeHtml","range","container","commonAncestorContainer","document","body","cloneNode","appendChild","cloneContents","innerHTML","hylyt","startLocation","endLocation","id","Math","max","apply","hylyts","map","hl","html","startSelector","startNodeIndex","index","startOffset","offset","endSelector","endNodeIndex","endOffset","deleted","elems","console","warn","onHylytClick","evt","makeCurrent","call","stopPropagation","forEach","elem","addEventListener","push","highlightSelection","selection","i","getRangeAt","collapsed","normalize","len","rangeCount","currentRange","setEnd","re","lastIndex","exec","textContent","setStart","postEndString","substr","search","length","showScrollIndicator","article","hasChild","review","setFirstReview","port","emit","emitHylyt","getSelection","isCollapsed","getLocation","splitText","affectedElems","WeakMap","textNode","nodeIndex","indexOf","childNodes","affected","get","splits","node","data","parentNode","newNode","location","set","sort","a","b","getSelector","ele","ownerDocument","getElementById","tagName","toLowerCase","isUnique","selector","querySelectorAll","e","classList","item","getNthOfType","addSpans","replace","span","createElement","replaceChild","isEmpty","test","getNextNode","outer","sibling","nextSibling","getComputedStyle","MozUserSelect","firstChild","error","spans","last"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;+BCjCSA,uB;;;SAqBOC,c,GAAAA,c;SAiFAC,S,GAAAA,S;;AA1GhB;;AACA;;;;AACA;;;;;;AAKA,UAASC,YAAT,CAAsBC,cAAtB,EAA4CC,YAA5C,EAAgE;AAC9D,UACED,eAAeE,QAAf,KAA4BC,KAAKC,SAAjC,IACAH,aAAaC,QAAb,KAA0BC,KAAKC,SAD/B,IAEAJ,eAAeK,aAFf,IAGAL,eAAeK,aAAf,CAA6BC,SAA7B,KAA2C,OAH3C,IAIAL,aAAaI,aAJb,IAKAJ,aAAaI,aAAb,CAA2BC,SAA3B,KAAyC,OAN3C;AAQD;;AAED,UAASC,YAAT,CAAsBC,KAAtB,EAA6B;AAC3B,OAAMC,YAAY,CAACD,MAAME,uBAAN,CAA8BL,aAA9B,IACjBM,SAASC,IADO,EACDC,SADC,CACS,KADT,CAAlB;AAEAJ,aAAUK,WAAV,CAAsBN,MAAMO,aAAN,EAAtB;AACA,UAAON,UAAUO,SAAjB;AACD;;AAEM,UAASnB,cAAT,CAAwBW,KAAxB,EAAsCS,KAAtC,EAAsD;AAAA,OACnDjB,cADmD,GAClBQ,KADkB,CACnDR,cADmD;AAAA,OACnCC,YADmC,GAClBO,KADkB,CACnCP,YADmC;;AAE3D,OAAI,CAACF,aAAaC,cAAb,EAA6BC,YAA7B,CAAL,EAAiD,OAAO,IAAP;AACjD,OAAI,CAACgB,KAAL,EAAY;AACV,SAAMC,gBAAgB,8BAAYlB,cAAZ,CAAtB;AACA,SAAMmB,cAAc,8BAAYlB,YAAZ,CAApB;AACAgB,aAAQ;AACNG,WAAIC,KAAKC,GAAL,CAASC,KAAT,CAAe,IAAf,EAAqB,KAAKC,MAAL,CAAYC,GAAZ,CAAgB,UAACC,EAAD;AAAA,gBAAQA,GAAGN,EAAX;AAAA,QAAhB,CAArB,IAAuD,CADrD;AAENO,aAAMpB,aAAaC,KAAb,CAFA;AAGNoB,sBAAe,2BAAY5B,cAAZ,CAHT;AAIN6B,uBAAgBX,cAAcY,KAJxB;AAKNC,oBAAavB,MAAMuB,WAAN,GAAoBb,cAAcc,MALzC;AAMNC,oBAAa,2BAAYhC,YAAZ,CANP;AAONiC,qBAAcf,YAAYW,KAPpB;AAQNK,kBAAW3B,MAAM2B,SAAN,GAAkBhB,YAAYa,MARnC;AASNI,gBAAS,KATH;AAUNC,cAAO;AAVD,MAAR;AAYD,IAfD,MAeO,IAAIpB,MAAMU,IAAN,KAAgBpB,aAAaC,KAAb,CAApB,EAA0C;AAC/C8B,aAAQC,IAAR,oDACgBtB,MAAMU,IADtB,+BAEmBpB,aAAaC,KAAb,CAFnB,0BAGcS,MAAMG,EAHpB;AAKD;AACDH,SAAMoB,KAAN,GAAc,wBAAS7B,KAAT,CAAd;AACA,YAASgC,YAAT,CAAsBC,GAAtB,EAA2B;AACzBC,iBAAYC,IAAZ,CAAiB,IAAjB,EAAuB1B,KAAvB;AACAwB,SAAIG,eAAJ;AACD;AACD3B,SAAMoB,KAAN,CAAYQ,OAAZ,CAAoB,UAACC,IAAD,EAAU;AAC5BA,UAAKC,gBAAL,CAAsB,OAAtB,EAA+BP,YAA/B;AACD,IAFD;AAGA,QAAKhB,MAAL,CAAYwB,IAAZ,CAAiB/B,KAAjB;AACA,UAAOA,KAAP;AACD;;AAED,UAASgC,kBAAT,CAA4BC,SAA5B,EAAuC;AACrC,OAAIC,IAAI,CAAR;AACA,OAAM3C,QAAQ0C,UAAUE,UAAV,CAAqB,CAArB,CAAd;AACA,OAAI5C,MAAM6C,SAAN,IACC7C,MAAMR,cAAN,KAAyBQ,MAAMP,YAA/B,IACDO,MAAM2B,SAAN,GAAkB3B,MAAMuB,WAAxB,GAAsC,CAF1C,EAE8C;AAC5C,YAAO,KAAP;AACD;AACDvB,SAAME,uBAAN,CAA8B4C,SAA9B;AACA,QAAK,IAAIC,MAAML,UAAUM,UAAV,GAAuB,CAAtC,EACIL,IAAII,GAAJ,IAAW/C,MAAMP,YAAN,CAAmBC,QAAnB,KAAgCC,KAAKC,SADpD,EAEI+C,GAFJ,EAES;AACP,SAAMM,eAAeP,UAAUE,UAAV,CAAqBD,CAArB,CAArB;AACA3C,WAAMkD,MAAN,CAAaD,aAAaxD,YAA1B,EAAwCwD,aAAatB,SAArD;AACD;AACD,OAAMwB,KAAK,SAAX;AACA;AACA;AACA,OAAIC,YAAY,CAAhB;AACA,UAAOD,GAAGC,SAAH,IAAgBpD,MAAMuB,WAA7B,EAA0C;AACxC6B,iBAAYD,GAAGC,SAAf;AACA,SAAI,CAACD,GAAGE,IAAH,CAAQrD,MAAMR,cAAN,CAAqB8D,WAA7B,CAAL,EAAgD;AACjD;AACDtD,SAAMuD,QAAN,CAAevD,MAAMR,cAArB,EAAqC4D,SAArC;AACAD,MAAGC,SAAH,GAAe,CAAf;AACA,OAAMI,gBAAgBxD,MAAMP,YAAN,CAAmB6D,WAAnB,CAA+BG,MAA/B,CAAsCzD,MAAM2B,SAA5C,CAAtB;AACAyB,eAAYI,cAAcE,MAAd,CAAqBP,EAArB,CAAZ;AACA,OAAIC,cAAc,CAAC,CAAnB,EAAsBA,YAAYI,cAAcG,MAA1B;AACtB3D,SAAMkD,MAAN,CAAalD,MAAMP,YAAnB,EAAiCO,MAAM2B,SAAN,GAAkByB,SAAnD;;AAEA,OAAM3C,QAAQpB,eAAeW,KAAf,CAAd;AACA,OAAI,CAACS,KAAL,EAAY,OAAO,KAAP;AACZmD,uBAAoBnD,KAApB;AACA,OAAI,KAAKO,MAAL,CAAY2C,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B,UAAKE,OAAL,CAAaC,QAAb,GAAwB,IAAxB;AACA;AACA,SAAI,KAAKD,OAAL,CAAaE,MAAb,KAAwB,CAA5B,EAA+BC,eAAe,KAAKH,OAApB;AAC/BI,UAAKC,IAAL,CAAU,SAAV,EAAqB,KAAKL,OAA1B;AACD;AACD3B,eAAYzB,KAAZ;AACA,QAAK0D,SAAL,CAAe1D,KAAf;AACA,UAAO,IAAP;AACD;;AAEM,UAASnB,SAAT,GAAqB;AAC1B;AACA,OAAMoD,YAAY0B,cAAlB;AACA,OAAI1B,aAAa,CAACA,UAAU2B,WAA5B,EAAyC;AACvC,YAAO5B,mBAAmBC,SAAnB,CAAP;AACD;AACD,UAAO,KAAP;AACD,E;;;;;;;;;;;SC/Ge4B,W,GAAAA,W;SAyCAC,S,GAAAA,S;AA3ChB,KAAMC,gBAAgB,IAAIC,OAAJ,EAAtB;;AAEO,UAASH,WAAT,CAAqBI,QAArB,EAAqC;AAAA,OAClC7E,aADkC,GAChB6E,QADgB,CAClC7E,aADkC;;AAE1C,OAAI8E,YAAY,GAAGC,OAAH,CAAWzC,IAAX,CAAgBtC,cAAcgF,UAA9B,EAA0CH,QAA1C,CAAhB;AACA,OAAMI,WAAWN,cAAcO,GAAd,CAAkBlF,aAAlB,CAAjB;AACA,OAAI,CAACiF,QAAL,EAAe,OAAO;AACpBxD,YAAOqD,SADa;AAEpBnD,aAAQ;AAFY,IAAP;AAIf;AACA,QAAK,IAAIF,MAAT,IAAkBwD,QAAlB,EAA4B;AAC1BxD,eAAS,CAAT;AACA,SAAI0D,SAASF,SAASxD,MAAT,CAAb;AACA,SAAIA,SAAQqD,SAAZ,EAAuB;AACvB,SAAIA,aAAaK,OAAOrB,MAAP,GAAgBrC,MAAjC,EACEqD,aAAaK,OAAOrB,MAApB,CADF,KAEK,IAAIgB,YAAYrD,MAAhB,EAAuB,OAAO;AACjCA,cAAOA,MAD0B;AAEjCE,eAAQwD,OAAOL,YAAYrD,MAAZ,GAAoB,CAA3B;AAFyB,MAAP;AAI5B,SAAIA,WAAUqD,SAAd,EAAyB;AACvB,WAAM5B,MAAMiC,OAAOrB,MAAnB;AACA,cAAO;AACLrC,gBAAOqD,SADF;AAELnD,iBAAQuB,MAAMiC,OAAOjC,MAAM,CAAb,CAAN,GAAwB;AAF3B,QAAP;AAID;AACF;AACD;;;;;;;;AAQA,UAAO;AACLzB,YAAOqD,SADF;AAELnD,aAAQ;AAFH,IAAP;AAID;;AAEM,UAAS+C,SAAT,CAAmBU,IAAnB,EAA+BzD,MAA/B,EAA+C;AACpD,OAAI,CAACA,MAAD,IAAWA,WAAWyD,KAAKC,IAAL,CAAUvB,MAApC,EAA4C,OAAOsB,IAAP;AAC5C,OAAME,aAAa,EAAEF,UAAF,EAAnB;AACA,OAAMG,UAAUH,KAAKV,SAAL,CAAe/C,MAAf,CAAhB;AACA,OAAM6D,WAA8Cf,YAAYW,IAAZ,CAApD;AACA,OAAIH,WAAWN,cAAcO,GAAd,CAAkBI,UAAlB,CAAf;AACA,OAAI,CAACL,QAAL,EAAe;AACbA,gBAAW,EAAX;AACAN,mBAAcc,GAAd,CAAkBH,UAAlB,EAA8BL,QAA9B;AACD;AACD,OAAI,CAACA,SAASO,SAAS/D,KAAlB,CAAL,EAA+BwD,SAASO,SAAS/D,KAAlB,IAA2B,EAA3B;AAC/BwD,YAASO,SAAS/D,KAAlB,EAAyBkB,IAAzB,CAA8B6C,SAAS7D,MAAT,GAAkBA,MAAhD;AACAsD,YAASO,SAAS/D,KAAlB,EAAyBiE,IAAzB,CAA8B,UAACC,CAAD,EAAIC,CAAJ;AAAA,YAAUD,IAAIC,CAAd;AAAA,IAA9B;AACA,UAAOL,OAAP;AACD,E;;;;;;;;;;;mBCpDuBM,W;AANxB;;;;;;AAMe,UAASA,WAAT,CAAqBC,GAArB,EAA0B;AACvC,OAAIA,IAAIjG,QAAJ,KAAeC,KAAKC,SAAxB,EAAmC+F,MAAMA,IAAIR,UAAV;AACnC,OAAIhF,WAAWwF,IAAIC,aAAnB;AACA,OAAID,IAAI/E,EAAJ,IAAUT,SAAS0F,cAAT,CAAwBF,IAAI/E,EAA5B,MAAoC+E,GAAlD,EAAuD;AACrD,YAAO,MAAMA,IAAI/E,EAAjB;AACD;;AAED;AACA,OAAIkF,UAAUH,IAAIG,OAAJ,CAAYC,WAAZ,EAAd;AACA,OAAID,YAAU,MAAV,IAAoBA,YAAU,MAA9B,IAAwCA,YAAU,MAAtD,EACE,OAAOA,OAAP;;AAEF,OAAI,CAACH,IAAIR,UAAT,EAAqBrD,QAAQC,IAAR,CAAa,aAAa+D,OAA1B;;AAErB;AACA,OAAIE,WAAW,SAAXA,QAAW,CAASC,QAAT,EAAmB;AAChC,SAAI;AACF,WAAI9F,SAAS+F,gBAAT,CAA0BD,QAA1B,EAAoCtC,MAApC,KAA6C,CAAjD,EAAoD,OAAO,IAAP;AACrD,MAFD,CAEE,OAAOwC,CAAP,EAAU,CAAE;AACd,YAAO,KAAP;AACD,IALD;;AAOA,OAAIF,QAAJ;AACA,OAAIN,IAAIS,SAAJ,CAAczC,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,UAAK,IAAIhB,IAAI,CAAb,EAAgBA,IAAIgD,IAAIS,SAAJ,CAAczC,MAAlC,EAA0ChB,GAA1C,EAA+C;AAC7C;AACAsD,kBAAW,MAAMN,IAAIS,SAAJ,CAAcC,IAAd,CAAmB1D,CAAnB,CAAjB;AACA,WAAIqD,SAASC,QAAT,CAAJ,EAAwB,OAAOA,QAAP;AACxB;AACAA,kBAAWH,UAAUG,QAArB;AACA,WAAID,SAASC,QAAT,CAAJ,EAAwB,OAAOA,QAAP;AACxB;AACAA,kBAAWA,WAAWK,aAAaX,GAAb,CAAtB;AACA,WAAIK,SAASC,QAAT,CAAJ,EAAwB,OAAOA,QAAP;AACzB;AACF;;AAED;AACAA,cAAWP,YAAYC,IAAIR,UAAhB,IAA8B,KAA9B,GAAsCW,OAAtC,GAAgDQ,aAAaX,GAAb,CAA3D;;AAEA,UAAOM,QAAP;AACD;;;;;;;;;;;;mBCTuBM,Q;;AArCxB;;AAEA,UAASC,OAAT,CAAiBvB,IAAjB,EAAuB;AACrB,OAAMwB,OAAOtG,SAASuG,aAAT,CAAuB,OAAvB,CAAb;AACAD,QAAKnD,WAAL,GAAmB2B,KAAK3B,WAAxB;AACA2B,QAAKE,UAAL,CAAgBwB,YAAhB,CAA6BF,IAA7B,EAAmCxB,IAAnC;AACA,UAAOwB,IAAP;AACD;;;AAED,UAASG,OAAT,CAAiB3B,IAAjB,EAAuB;AACrB,UAAO,CAAC,KAAK4B,IAAL,CAAU5B,KAAK3B,WAAf,CAAR;AACD;;AAED,UAASwD,WAAT,CAAqB7B,IAArB,EAA2B;AACzB8B,UAAO,OAAO9B,IAAP,EAAa;AAClB,SAAI+B,UAAU/B,KAAKgC,WAAnB;AACJ;AACI,SAAI,CAACD,OAAL,EAAc;AACZ/B,cAAOA,KAAKE,UAAZ;AACN;AACM;AACD;AACD,YAAO6B,OAAP,EAAgB;AACd,WAAIA,QAAQtH,QAAR,KAAmBC,KAAKC,SAAxB,IACAsH,iBAAiBF,OAAjB,EAA0BG,aAA1B,KAA0C,MAD9C,EACsD;AACpDlC,gBAAO+B,OAAP;AACA,kBAASD,KAAT;AACD;AACD9B,cAAO+B,OAAP;AACAA,iBAAUA,QAAQI,UAAlB;AACD;AACD,YAAOnC,IAAP;AACD;AACDnD,WAAQuF,KAAR,CAAc,wDAAd;AACA,UAAO,IAAP;AACD;;AAEc,UAASd,QAAT,CAAkBvG,KAAlB,EAAyB;AACtC,OAAMsH,QAAQ,EAAd;AACA,OAAI5C,WAAW1E,MAAMR,cAArB;;AAEAkF,cAAW,4BAAUA,QAAV,EAAoB1E,MAAMuB,WAA1B,CAAX;AACA,OAAIgG,aAAJ;AACA,MAAG;AACDA,YAAO7C,aAAa1E,MAAMP,YAA1B;AACA,SAAI8H,IAAJ,EAAU,4BAAU7C,QAAV,EAAoB1E,MAAM2B,SAA1B;AACV,SAAI,CAACiF,QAAQlC,QAAR,CAAL,EAAwB;AACtBA,kBAAW8B,QAAQ9B,QAAR,CAAX;AACA4C,aAAM9E,IAAN,CAAWkC,QAAX;AACD;AACD,SAAI6C,IAAJ,EAAU,OAAOD,KAAP;AACV5C,gBAAWoC,YAAYpC,QAAZ,CAAX;AACD,IATD,QASS,CAAC6C,IATV;AAUAzF,WAAQuF,KAAR,CAAc,wDAAd;AACD","file":"hibou-highlighter.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"hibou-highlighter\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"hibou-highlighter\"] = factory();\n\telse\n\t\troot[\"hibou-highlighter\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 508176650e4a709eca3b","// @flow\nimport { getLocation } from './dom-mutation';\nimport getSelector from './get-selector';\nimport addSpans from './add-spans';\n\nexport { changeSelectedHighlight } from './selected-highlight';\n\n\nfunction isValidRange(startContainer: Node, endContainer: Node) {\n  return (\n    startContainer.nodeType === Node.TEXT_NODE &&\n    endContainer.nodeType === Node.TEXT_NODE &&\n    startContainer.parentElement &&\n    startContainer.parentElement.localName !== 'hylyt' &&\n    endContainer.parentElement &&\n    endContainer.parentElement.localName !== 'hylyt'\n  );\n}\n\nfunction getRangeHtml(range) {\n  const container = (range.commonAncestorContainer.parentElement ||\n    document.body).cloneNode(false);\n  container.appendChild(range.cloneContents());\n  return container.innerHTML;\n}\n\nexport function highlightRange(range: Range, hylyt?: Object) {\n  const { startContainer, endContainer } = range;\n  if (!isValidRange(startContainer, endContainer)) return null;\n  if (!hylyt) {\n    const startLocation = getLocation(startContainer);\n    const endLocation = getLocation(endContainer);\n    hylyt = {\n      id: Math.max.apply(null, this.hylyts.map((hl) => hl.id)) + 1,\n      html: getRangeHtml(range),\n      startSelector: getSelector(startContainer),\n      startNodeIndex: startLocation.index,\n      startOffset: range.startOffset + startLocation.offset,\n      endSelector: getSelector(endContainer),\n      endNodeIndex: endLocation.index,\n      endOffset: range.endOffset + endLocation.offset,\n      deleted: false,\n      elems: null\n    };\n  } else if (hylyt.html !== (getRangeHtml(range))) {\n    console.warn(`hylyt restored incorrectly\n      Saved HTML: ${hylyt.html}\n      Restored HTML: ${getRangeHtml(range)}\n      hylyt.id: ${hylyt.id}`\n    );\n  }\n  hylyt.elems = addSpans(range);\n  function onHylytClick(evt) {\n    makeCurrent.call(this, hylyt);\n    evt.stopPropagation();\n  }\n  hylyt.elems.forEach((elem) => {\n    elem.addEventListener('click', onHylytClick);\n  });\n  this.hylyts.push(hylyt);\n  return hylyt;\n}\n\nfunction highlightSelection(selection) {\n  let i = 0;\n  const range = selection.getRangeAt(0);\n  if (range.collapsed ||\n      (range.startContainer === range.endContainer &&\n      range.endOffset - range.startOffset < 3)) {\n    return false;\n  }\n  range.commonAncestorContainer.normalize();\n  for (let len = selection.rangeCount - 1;\n      i < len && range.endContainer.nodeType !== Node.TEXT_NODE;\n      i++) {\n    const currentRange = selection.getRangeAt(i);\n    range.setEnd(currentRange.endContainer, currentRange.endOffset);\n  }\n  const re = /[^\\w']/g;\n  //if doing unicode regions:\n  // [\\w\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u01BF\\u01C4-\\u02b8]\n  let lastIndex = 0;\n  while (re.lastIndex <= range.startOffset) {\n    lastIndex = re.lastIndex;\n    if (!re.exec(range.startContainer.textContent)) break;\n  }\n  range.setStart(range.startContainer, lastIndex);\n  re.lastIndex = 0;\n  const postEndString = range.endContainer.textContent.substr(range.endOffset);\n  lastIndex = postEndString.search(re);\n  if (lastIndex === -1) lastIndex = postEndString.length;\n  range.setEnd(range.endContainer, range.endOffset + lastIndex);\n\n  const hylyt = highlightRange(range);\n  if (!hylyt) return false;\n  showScrollIndicator(hylyt);\n  if (this.hylyts.length === 1) {\n    this.article.hasChild = true;\n    // review equals 0 if this.article is muted\n    if (this.article.review !== 0) setFirstReview(this.article);\n    port.emit('article', this.article);\n  }\n  makeCurrent(hylyt);\n  this.emitHylyt(hylyt);\n  return true;\n}\n\nexport function highlight() {\n  // Highlight if text selected\n  const selection = getSelection();\n  if (selection && !selection.isCollapsed) {\n    return highlightSelection(selection);\n  }\n  return false;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","//@flow\nconst affectedElems = new WeakMap();\n\nexport function getLocation(textNode: Node) {\n  const { parentElement } = textNode;\n  let nodeIndex = [].indexOf.call(parentElement.childNodes, textNode);\n  const affected = affectedElems.get(parentElement);\n  if (!affected) return {\n    index: nodeIndex,\n    offset: 0\n  };\n  // leaving for...in until I can test\n  for (let index in affected) {\n    index *= 1;\n    let splits = affected[index];\n    if (index > nodeIndex) break;\n    if (nodeIndex >= splits.length + index)\n      nodeIndex -= splits.length;\n    else if (nodeIndex > index) return {\n      index: index,\n      offset: splits[nodeIndex - index - 1]\n    };\n    if (index === nodeIndex) {\n      const len = splits.length;\n      return {\n        index: nodeIndex,\n        offset: len ? splits[len - 1] : 0\n      };\n    }\n  }\n  /*const index = affected.findIndex((splits, i: number) => {\n    if (i > nodeIndex) return false;\n    if (nodeIndex >= splits.length + i) nodeIndex -= splits.length;\n    if (nodeIndex >= i) return true;\n    return false;\n  });\n  // can this evr happen?\n  if (nodeIndex > index)*/\n  return {\n    index: nodeIndex,\n    offset: 0\n  };\n}\n\nexport function splitText(node: Text, offset: number) {\n  if (!offset || offset === node.data.length) return node;\n  const parentNode = { node };\n  const newNode = node.splitText(offset);\n  const location: { index: number, offset: number } = getLocation(node);\n  let affected = affectedElems.get(parentNode);\n  if (!affected) {\n    affected = [];\n    affectedElems.set(parentNode, affected);\n  }\n  if (!affected[location.index]) affected[location.index] = [];\n  affected[location.index].push(location.offset + offset);\n  affected[location.index].sort((a, b) => a - b);\n  return newNode;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom-mutation.js","/**\n * Find a unique CSS selector for a given element\n * @returns a string such that ele.ownerDocument.querySelector(reply) === ele\n * and ele.ownerDocument.querySelectorAll(reply).length === 1\n */\n\nexport default function getSelector(ele) {\n  if (ele.nodeType===Node.TEXT_NODE) ele = ele.parentNode;\n  var document = ele.ownerDocument;\n  if (ele.id && document.getElementById(ele.id) === ele) {\n    return '#' + ele.id;\n  }\n\n  // Inherently unique by tag name\n  var tagName = ele.tagName.toLowerCase();\n  if (tagName==='html' || tagName==='head' || tagName==='body')\n    return tagName;\n\n  if (!ele.parentNode) console.warn('danger: ' + tagName);\n\n  // We might be able to find a unique class name\n  var isUnique = function(selector) {\n    try {\n      if (document.querySelectorAll(selector).length===1) return true;\n    } catch (e) {}\n    return false;\n  };\n\n  var selector;\n  if (ele.classList.length > 0) {\n    for (var i = 0; i < ele.classList.length; i++) {\n      // Is this className unique by itself?\n      selector = '.' + ele.classList.item(i);\n      if (isUnique(selector)) return selector;\n      // Maybe it's unique with a tag name?\n      selector = tagName + selector;\n      if (isUnique(selector)) return selector;\n      // Maybe it's unique using a tag name and nth-child\n      selector = selector + getNthOfType(ele);\n      if (isUnique(selector)) return selector;\n    }\n  }\n\n  // So we can be unique w.r.t. our parent, and use recursion\n  selector = getSelector(ele.parentNode) + ' > ' + tagName + getNthOfType(ele);\n\n  return selector;\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/get-selector.js","//@flow\nimport { splitText } from './dom-mutation';\n\nfunction replace(node) {\n  const span = document.createElement('hylyt');\n  span.textContent = node.textContent;\n  node.parentNode.replaceChild(span, node);\n  return span;\n}\n\nfunction isEmpty(node) {\n  return !/\\S/.test(node.textContent);\n}\n\nfunction getNextNode(node) {\n  outer: while (node) {\n    let sibling = node.nextSibling;\n//       console.log(TAG+'sibling: '+sibling);\n    if (!sibling) {\n      node = node.parentNode;\n//         console.log(TAG+'no sibling. node = '+node);\n      continue;\n    }\n    while (sibling) {\n      if (sibling.nodeType!==Node.TEXT_NODE &&\n          getComputedStyle(sibling).MozUserSelect==='none') {\n        node = sibling;\n        continue outer;\n      }\n      node = sibling;\n      sibling = sibling.firstChild;\n    }\n    return node;\n  }\n  console.error('did not encounter last node while finding next sibling');\n  return null;\n}\n\nexport default function addSpans(range) {\n  const spans = [];\n  let textNode = range.startContainer;\n\n  textNode = splitText(textNode, range.startOffset);\n  let last;\n  do {\n    last = textNode === range.endContainer;\n    if (last) splitText(textNode, range.endOffset);\n    if (!isEmpty(textNode)) {\n      textNode = replace(textNode);\n      spans.push(textNode);\n    }\n    if (last) return spans;\n    textNode = getNextNode(textNode);\n  } while (!last);\n  console.error('did not encounter last node while finding next sibling');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/add-spans.js"],"sourceRoot":""}